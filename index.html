<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Formatter Pro - Ultimate</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0070F3;
            --primary-hover: #005BB5;
            --secondary-color: #17C964;
            --background-color: #F4F7FA;
            --surface-color: #FFFFFF;
            --error-color: #FF3B30;
            --success-color: #34C759;
            --warning-color: #FF9500;
            --text-primary: #0A0A0A;
            --text-secondary: #6E6E73;
            --border-radius: 20px;
            --transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(to bottom right, var(--background-color), #E0E7FF);
            line-height: 1.6;
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 1.5rem;
            padding: 1rem 1.5rem;
            background: var(--surface-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.03);
        }

        .header h1 {
            color: var(--primary-color);
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            letter-spacing: -0.03em;
        }

        .header .badge {
            display: inline-block;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 0.15rem 0.5rem;
            border-radius: 15px;
            font-size: 0.65rem;
            font-weight: 600;
            margin: 0 0.15rem 0.25rem;
        }

        .header .badge.auto-fix {
            background: linear-gradient(to right, var(--warning-color), var(--error-color));
            animation: pulse 2s infinite;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 400;
            margin-bottom: 0.75rem;
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        .theme-toggle-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
            color: white;
            letter-spacing: 0.025em;
            background: linear-gradient(to right, #8E8E93, #AEAEB2);
            box-shadow: 0 2px 4px rgba(142, 142, 147, 0.2);
        }

        .theme-toggle-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(142, 142, 147, 0.3);
        }

        .auto-fix-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--background-color);
            padding: 0.5rem 1rem;
            border-radius: 10px;
        }

        .auto-fix-toggle label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .auto-fix-toggle input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .shortcuts-info {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: var(--surface-color);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            display: none;
            max-width: 400px;
        }

        .shortcuts-info.show {
            display: block;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .shortcuts-info h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            border-radius: 8px;
            background: var(--background-color);
        }

        .shortcut-key {
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .main-content {
            display: flex;
            gap: 2rem;
            flex: 1;
            min-height: 0;
        }

        .panel-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .panel {
            background: var(--surface-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.03);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: var(--transition);
            height: 100%;
        }

        .panel:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }

        .panel-header {
            padding: 1.5rem;
            border-bottom: 1px solid #E5E7EB;
            background: #FAFAFA;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .panel-header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .panel-title {
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.125rem;
        }

        .panel-title i {
            color: var(--primary-color);
        }

        .panel-content {
            flex: 1;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .fix-status {
            display: none;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--warning-color);
            color: white;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            animation: slideDown 0.3s ease;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .fix-status.show {
            display: flex;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .view-mode-toggle {
            display: flex;
            gap: 0.5rem;
            background: var(--background-color);
            padding: 0.25rem;
            border-radius: 10px;
        }

        .view-mode-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .view-mode-btn.active {
            background: white;
            color: var(--primary-color);
            box-shadow: var(--shadow-sm);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 160px;
            height: 40px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            transition: var(--transition);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 32px;
            width: 32px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle-text {
            color: white;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            user-select: none;
        }

        .toggle-text.left {
            margin-right: 28px;
        }

        .toggle-text.right {
            margin-left: 28px;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(120px);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
            color: white;
            letter-spacing: 0.025em;
        }

        .btn-primary {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            box-shadow: 0 2px 4px rgba(0, 112, 243, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 112, 243, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(to right, #8E8E93, #AEAEB2);
            box-shadow: 0 2px 4px rgba(142, 142, 147, 0.2);
        }

        .btn-secondary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(142, 142, 147, 0.3);
        }

        .btn-icon {
            padding: 0.75rem;
            min-width: 44px;
            justify-content: center;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* ‚ú® INPUT EDITOR WITH SYNTAX HIGHLIGHTING */
        .input-editor-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #jsonInputHighlight {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 1rem;
            margin: 0;
            border: none;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            background: var(--surface-color);
            overflow-y: auto;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
            pointer-events: none;
            color: transparent;
        }

        #jsonInput {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 1rem;
            border: none;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: transparent;
            caret-color: var(--text-primary);
            background: transparent;
            resize: none;
            outline: none;
            overflow-y: auto;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
            z-index: 2;
        }

        #jsonInput::placeholder {
            color: var(--text-secondary);
            opacity: 0.5;
        }

        pre.output {
            margin: 0;
            padding: 1rem;
            height: 100%;
            background: var(--surface-color);
            overflow-y: auto;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
        }

        pre.output code {
            background: none;
            padding: 0;
            display: block;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
        }

        /* ‚ú® JSON SYNTAX HIGHLIGHTING - Inspired by CodeBeautify */
        /* Light Mode */
        .json-key {
            color: #881391 !important; /* Purple for keys */
            font-weight: 600 !important;
        }

        .json-string {
            color: #1A1AA6 !important; /* Deep blue for strings */
        }

        .json-number {
            color: #1C00CF !important; /* Blue for numbers */
            font-weight: 500 !important;
        }

        .json-boolean {
            color: #0D22AA !important; /* Blue for booleans */
            font-weight: 600 !important;
        }

        .json-null {
            color: #808080 !important; /* Gray for null */
            font-weight: 600 !important;
            font-style: italic;
        }

        .json-punctuation {
            color: #000000 !important; /* Black for brackets/braces */
        }

        /* JSON Tree View - Light Mode */
        .json-tree {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            padding: 1rem;
            font-size: 0.9rem;
            line-height: 1.6;
            height: 100%;
            overflow-y: auto;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .tree-node {
            margin-left: 1.5rem;
        }

        .tree-key {
            color: #881391;
            font-weight: 600;
            word-break: break-all;
        }

        .tree-value {
            color: #000000;
            word-break: break-all;
        }

        .tree-string {
            color: #1A1AA6;
            word-break: break-all;
        }

        .tree-number {
            color: #1C00CF;
            font-weight: 500;
        }

        .tree-boolean {
            color: #0D22AA;
            font-weight: 600;
        }

        .tree-null {
            color: #808080;
            font-weight: 600;
            font-style: italic;
        }

        .tree-toggle {
            cursor: pointer;
            user-select: none;
            display: inline-block;
            width: 20px;
            color: #881391;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .tree-toggle:hover {
            color: #6B0F74;
        }

        .tree-collapsed {
            display: none;
        }

        .tree-line {
            padding: 0.25rem 0;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .tree-line:hover {
            background: rgba(136, 19, 145, 0.05);
        }

        /* Dark Mode Colors */
        [data-theme="dark"] {
            --background-color: #1E1E1E;
            --surface-color: #252526;
            --text-primary: #D4D4D4;
            --text-secondary: #858585;
        }

        [data-theme="dark"] body {
            background: linear-gradient(to bottom right, #1E1E1E, #2D2D30);
        }

        [data-theme="dark"] .panel-header {
            background: #2D2D30;
            border-color: #3E3E42;
        }

        [data-theme="dark"] #jsonInput {
            caret-color: #D4D4D4;
        }

        [data-theme="dark"] #jsonInput::placeholder {
            color: #858585;
        }

        [data-theme="dark"] #jsonInputHighlight,
        [data-theme="dark"] pre.output {
            background: #1E1E1E;
            color: #D4D4D4;
        }

        [data-theme="dark"] .view-mode-toggle {
            background: #2D2D30;
        }

        [data-theme="dark"] .view-mode-btn.active {
            background: #3E3E42;
        }

        [data-theme="dark"] .json-key {
            color: #9CDCFE !important;
        }

        [data-theme="dark"] .json-string {
            color: #CE9178 !important;
        }

        [data-theme="dark"] .json-number {
            color: #B5CEA8 !important;
        }

        [data-theme="dark"] .json-boolean {
            color: #569CD6 !important;
        }

        [data-theme="dark"] .json-null {
            color: #858585 !important;
        }

        [data-theme="dark"] .json-punctuation {
            color: #D4D4D4 !important;
        }

        [data-theme="dark"] .tree-key {
            color: #9CDCFE;
        }

        [data-theme="dark"] .tree-value {
            color: #D4D4D4;
        }

        [data-theme="dark"] .tree-string {
            color: #CE9178;
        }

        [data-theme="dark"] .tree-number {
            color: #B5CEA8;
        }

        [data-theme="dark"] .tree-boolean {
            color: #569CD6;
        }

        [data-theme="dark"] .tree-null {
            color: #858585;
        }

        [data-theme="dark"] .tree-toggle {
            color: #9CDCFE;
        }

        [data-theme="dark"] .tree-toggle:hover {
            color: #7CB8F0;
        }

        [data-theme="dark"] .tree-line:hover {
            background: rgba(156, 220, 254, 0.1);
        }

        /* Custom Scrollbar */
        #jsonInput::-webkit-scrollbar,
        #jsonInputHighlight::-webkit-scrollbar,
        pre.output::-webkit-scrollbar,
        .json-tree::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        #jsonInput::-webkit-scrollbar-track,
        #jsonInputHighlight::-webkit-scrollbar-track,
        pre.output::-webkit-scrollbar-track,
        .json-tree::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            margin: 4px;
        }

        #jsonInput::-webkit-scrollbar-thumb,
        #jsonInputHighlight::-webkit-scrollbar-thumb,
        pre.output::-webkit-scrollbar-thumb,
        .json-tree::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
            border: 2px solid var(--surface-color);
        }

        #jsonInput::-webkit-scrollbar-thumb:hover,
        #jsonInputHighlight::-webkit-scrollbar-thumb:hover,
        pre.output::-webkit-scrollbar-thumb:hover,
        .json-tree::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--primary-hover), var(--primary-color));
        }

        [data-theme="dark"] #jsonInput::-webkit-scrollbar-track,
        [data-theme="dark"] #jsonInputHighlight::-webkit-scrollbar-track,
        [data-theme="dark"] pre.output::-webkit-scrollbar-track,
        [data-theme="dark"] .json-tree::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        [data-theme="dark"] #jsonInput::-webkit-scrollbar-thumb,
        [data-theme="dark"] #jsonInputHighlight::-webkit-scrollbar-thumb,
        [data-theme="dark"] pre.output::-webkit-scrollbar-thumb,
        [data-theme="dark"] .json-tree::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #569CD6, #4A8BC2);
            border-color: #252526;
        }

        #jsonInput::-webkit-scrollbar-corner,
        #jsonInputHighlight::-webkit-scrollbar-corner,
        pre.output::-webkit-scrollbar-corner,
        .json-tree::-webkit-scrollbar-corner {
            background: var(--surface-color);
        }

        .alert {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            display: none;
            animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            align-items: center;
            gap: 0.75rem;
            backdrop-filter: blur(10px);
            max-width: 400px;
        }

        .alert.show {
            display: flex;
        }

        .alert-error {
            background: rgba(255, 59, 48, 0.95);
            color: white;
        }

        .alert-success {
            background: rgba(52, 199, 89, 0.95);
            color: white;
        }

        .alert-info {
            background: rgba(0, 112, 243, 0.95);
            color: white;
        }

        .alert-warning {
            background: rgba(255, 149, 0, 0.95);
            color: white;
        }

        @keyframes slideIn {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .footer {
            margin-top: 1.5rem;
            padding: 1rem 1.5rem;
            background: var(--surface-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.03);
            text-align: center;
        }

        .footer-content {
            display: flex;
            flex-direction: row;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .footer-team {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.85rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .footer-team i {
            color: var(--primary-color);
            font-size: 0.95rem;
        }

        .footer-copyright {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .footer-divider {
            width: 1px;
            height: 20px;
            background: var(--text-secondary);
            opacity: 0.2;
        }

        .footer-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .header {
                padding: 0.75rem 1rem;
                margin-bottom: 1rem;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .header p {
                font-size: 0.8rem;
                margin-bottom: 0.5rem;
            }

            .footer {
                padding: 0.75rem 1rem;
                margin-top: 1rem;
            }

            .footer-content {
                flex-direction: column;
                gap: 0.5rem;
            }

            .footer-divider {
                width: 50%;
                height: 1px;
            }
        }
    </style>
</head>
<body>

<div class="shortcuts-info" id="shortcutsInfo">
    <h3><i class="fas fa-keyboard"></i> Ph√≠m t·∫Øt</h3>
    <div class="shortcut-item">
        <span>Format JSON</span>
        <span class="shortcut-key">Ctrl + Enter</span>
    </div>
    <div class="shortcut-item">
        <span>X√≥a t·∫•t c·∫£</span>
        <span class="shortcut-key">Ctrl + K</span>
    </div>
    <div class="shortcut-item">
        <span>T·∫£i xu·ªëng</span>
        <span class="shortcut-key">Ctrl + S</span>
    </div>
    <div class="shortcut-item">
        <span>Ch·∫ø ƒë·ªô t·ªëi</span>
        <span class="shortcut-key">Ctrl + /</span>
    </div>
    <button class="btn btn-primary" onclick="toggleShortcuts()" style="margin-top: 1rem; width: 100%;">
        <i class="fas fa-times"></i> ƒê√≥ng
    </button>
</div>

<div class="container">
    <header class="header">
        <div>
            <span class="badge">PRO VERSION</span>
            <span class="badge auto-fix">üîß ULTIMATE AUTO-FIX</span>
        </div>
        <h1>JSON Formatter</h1>
        <p>C√¥ng c·ª• ƒë·ªãnh d·∫°ng JSON v·ªõi kh·∫£ nƒÉng t·ª± ƒë·ªông s·ª≠a l·ªói</p>
        <div class="header-actions">
            <div class="auto-fix-toggle">
                <label>
                    <input type="checkbox" id="autoFixToggle" checked>
                    <i class="fas fa-magic"></i>
                    <span>T·ª± ƒë·ªông s·ª≠a l·ªói</span>
                </label>
            </div>
            <button class="theme-toggle-btn" onclick="toggleTheme()">
                <i class="fas fa-moon" id="theme-icon"></i>
                <span id="theme-text">Dark Mode</span>
            </button>
            <button class="btn btn-secondary" onclick="toggleShortcuts()">
                <i class="fas fa-keyboard"></i>
                Ph√≠m t·∫Øt
            </button>
        </div>
    </header>

    <main class="main-content">
        <div class="panel-container">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-header-left">
                        <div class="panel-title">
                            <i class="fas fa-code"></i>
                            Input
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="formatToggle" checked onchange="toggleFormat()">
                            <span class="toggle-slider">
                                <span class="toggle-text left">Str</span>
                                <span class="toggle-text right">JSON</span>
                            </span>
                        </label>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="convertFormat()">
                            <i class="fas fa-sync-alt"></i>
                            Chuy·ªÉn ƒë·ªïi
                        </button>
                        <button class="btn btn-primary" onclick="minifyJSON()">
                            <i class="fas fa-compress"></i>
                            Minify
                        </button>
                        <button class="btn btn-secondary" onclick="clearAll()">
                            <i class="fas fa-trash"></i>
                            X√≥a
                        </button>
                    </div>
                </div>
                <div class="panel-content">
                    <div class="input-editor-wrapper">
                        <pre id="jsonInputHighlight"><code></code></pre>
                        <textarea id="jsonInput"
                                  placeholder="Nh·∫≠p JSON ho·∫∑c string c·ªßa b·∫°n v√†o ƒë√¢y..."
                                  spellcheck="false"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel-container">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-header-left">
                        <div class="panel-title">
                            <i class="fas fa-file-code"></i>
                            Output
                        </div>
                        <div class="fix-status" id="fixStatus">
                            <i class="fas fa-wrench"></i>
                            <span id="fixStatusText">ƒê√£ t·ª± ƒë·ªông s·ª≠a l·ªói!</span>
                        </div>
                        <div class="view-mode-toggle">
                            <button class="view-mode-btn active" data-mode="formatted"
                                    onclick="changeViewMode('formatted')">
                                <i class="fas fa-align-left"></i> Format
                            </button>
                            <button class="view-mode-btn" data-mode="tree" onclick="changeViewMode('tree')">
                                <i class="fas fa-sitemap"></i> Tree
                            </button>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="copyToClipboard()">
                            <i class="fas fa-copy"></i>
                            Copy
                        </button>
                        <button class="btn btn-primary" onclick="downloadJSON()">
                            <i class="fas fa-download"></i>
                            T·∫£i xu·ªëng
                        </button>
                    </div>
                </div>
                <div class="panel-content">
                    <pre class="output" id="formattedView"><code id="jsonOutput"></code></pre>
                    <div class="json-tree" id="treeView" style="display: none;"></div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-team">
                <i class="fas fa-users-cog"></i>
                <span>Team AppServer 1</span>
            </div>

            <div class="footer-divider"></div>

            <div class="footer-badge">
                <i class="fas fa-building"></i>
                <span>Ph√≤ng D·ªãch v·ª• Ng√¢n h√†ng</span>
            </div>

            <div class="footer-divider"></div>

            <div class="footer-copyright">
                <i class="far fa-copyright"></i>
                <span>2025 Hong Phat</span>
            </div>
        </div>
    </footer>

    <div id="errorAlert" class="alert alert-error">
        <i class="fas fa-exclamation-circle"></i>
        <span id="errorText"></span>
    </div>
    <div id="successAlert" class="alert alert-success">
        <i class="fas fa-check-circle"></i>
        <span id="successText">Th√†nh c√¥ng!</span>
    </div>
    <div id="infoAlert" class="alert alert-info">
        <i class="fas fa-info-circle"></i>
        <span id="infoText">Th√¥ng tin!</span>
    </div>
    <div id="warningAlert" class="alert alert-warning">
        <i class="fas fa-exclamation-triangle"></i>
        <span id="warningText">C·∫£nh b√°o!</span>
    </div>
</div>

<script>
    let isJsonMode = true;
    let currentViewMode = 'formatted';
    let currentParsedJSON = null;

    document.addEventListener('DOMContentLoaded', () => {
        initializeTheme();
        setupKeyboardShortcuts();
        setupInputHighlighting();

        document.getElementById('formatToggle').checked = true;
    });

    // ‚ú® SETUP INPUT SYNTAX HIGHLIGHTING
    function setupInputHighlighting() {
        const jsonInput = document.getElementById('jsonInput');
        const jsonInputHighlight = document.getElementById('jsonInputHighlight');

        // Sync scroll between textarea and highlight layer
        jsonInput.addEventListener('scroll', () => {
            jsonInputHighlight.scrollTop = jsonInput.scrollTop;
            jsonInputHighlight.scrollLeft = jsonInput.scrollLeft;
        });

        // Update highlighting on input
        jsonInput.addEventListener('input', () => {
            updateInputHighlight();
        });

        // Update on paste
        jsonInput.addEventListener('paste', () => {
            setTimeout(() => {
                updateInputHighlight();
                convertFormat();
            }, 0);
        });
    }

    function updateInputHighlight() {
        const jsonInput = document.getElementById('jsonInput');
        const jsonInputHighlight = document.getElementById('jsonInputHighlight');
        const text = jsonInput.value;

        if (!text) {
            jsonInputHighlight.innerHTML = '';
            return;
        }

        // Apply syntax highlighting
        const highlighted = syntaxHighlight(text);
        jsonInputHighlight.innerHTML = highlighted;
    }

    // ‚ú® CUSTOM JSON SYNTAX HIGHLIGHTER
    function syntaxHighlight(json) {
        json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
            let cls = 'json-number';
            if (/^"/.test(match)) {
                if (/:$/.test(match)) {
                    cls = 'json-key';
                } else {
                    cls = 'json-string';
                }
            } else if (/true|false/.test(match)) {
                cls = 'json-boolean';
            } else if (/null/.test(match)) {
                cls = 'json-null';
            }
            return '<span class="' + cls + '">' + match + '</span>';
        });
    }

    function autoFixJSON(jsonString) {
        let input = jsonString.trim();
        let changes = [];

        const multipleObjectsPattern = /}\s*\n\s*{/g;
        if (multipleObjectsPattern.test(input)) {
            const objects = [];
            let braceCount = 0;
            let currentObject = '';
            let inString = false;
            let escapeNext = false;

            for (let i = 0; i < input.length; i++) {
                const char = input[i];

                if (char === '"' && !escapeNext) {
                    inString = !inString;
                }

                escapeNext = (char === '\\' && !escapeNext);

                if (!inString) {
                    if (char === '{') {
                        braceCount++;
                    } else if (char === '}') {
                        braceCount--;
                    }
                }

                currentObject += char;

                if (braceCount === 0 && currentObject.trim().length > 0 && currentObject.trim().endsWith('}')) {
                    objects.push(currentObject.trim());
                    currentObject = '';
                }
            }

            if (currentObject.trim()) {
                objects.push(currentObject.trim());
            }

            if (objects.length > 1) {
                input = '[\n' + objects.join(',\n') + '\n]';
                changes.push(`Nh√≥m ${objects.length} objects th√†nh array`);
            }
        }

        let fixed = input;

        if (fixed.match(/,(\s*[}\]])/g)) {
            fixed = fixed.replace(/,(\s*[}\]])/g, '$1');
            changes.push('X√≥a d·∫•u ph·∫©y th·ª´a');
        }

        if (fixed.match(/([{,]\s*)([a-zA-Z_$][a-zA-Z0-9_$]*)\s*:/g)) {
            fixed = fixed.replace(/([{,]\s*)([a-zA-Z_$][a-zA-Z0-9_$]*)\s*:/g, '$1"$2":');
            changes.push('Th√™m ngo·∫∑c k√©p cho keys');
        }

        if (fixed.includes("'")) {
            fixed = fixed.replace(/'([^']*?)'/g, '"$1"');
            changes.push('Chuy·ªÉn ngo·∫∑c ƒë∆°n ‚Üí k√©p');
        }

        const openBraces = (fixed.match(/{/g) || []).length;
        const closeBraces = (fixed.match(/}/g) || []).length;
        const openBrackets = (fixed.match(/\[/g) || []).length;
        const closeBrackets = (fixed.match(/\]/g) || []).length;

        if (openBraces > closeBraces) {
            fixed += '}'.repeat(openBraces - closeBraces);
            changes.push(`Th√™m ${openBraces - closeBraces} d·∫•u '}'`);
        } else if (closeBraces > openBraces) {
            const extra = closeBraces - openBraces;
            for (let i = 0; i < extra; i++) {
                const idx = fixed.lastIndexOf('}');
                if (idx !== -1) {
                    fixed = fixed.substring(0, idx) + fixed.substring(idx + 1);
                }
            }
            changes.push(`X√≥a ${extra} d·∫•u '}'`);
        }

        if (openBrackets > closeBrackets) {
            fixed += ']'.repeat(openBrackets - closeBrackets);
            changes.push(`Th√™m ${openBrackets - closeBrackets} d·∫•u ']'`);
        } else if (closeBrackets > openBrackets) {
            const extra = closeBrackets - openBrackets;
            for (let i = 0; i < extra; i++) {
                const idx = fixed.lastIndexOf(']');
                if (idx !== -1) {
                    fixed = fixed.substring(0, idx) + fixed.substring(idx + 1);
                }
            }
            changes.push(`X√≥a ${extra} d·∫•u ']'`);
        }

        fixed = fixed.replace(/"\s*\n\s*"/g, '",\n"');
        fixed = fixed.replace(/([}\]])\s*\n\s*([{"\[])/g, '$1,\n$2');
        fixed = fixed.replace(/,+/g, ',');

        return {
            fixed: fixed,
            changes: changes.length > 0 ? changes : ['T·ªëi ∆∞u ƒë·ªãnh d·∫°ng']
        };
    }

    function setupKeyboardShortcuts() {
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                convertFormat();
                showAlert('info', 'ƒê√£ format JSON!');
            }

            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                clearAll();
                showAlert('info', 'ƒê√£ x√≥a t·∫•t c·∫£!');
            }

            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                downloadJSON();
            }

            if ((e.ctrlKey || e.metaKey) && e.key === '/') {
                e.preventDefault();
                toggleTheme();
            }
        });
    }

    function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute('data-theme');
        const themeIcon = document.getElementById('theme-icon');
        const themeText = document.getElementById('theme-text');

        if (currentTheme === 'dark') {
            html.removeAttribute('data-theme');
            localStorage.setItem('theme', 'light');
            themeIcon.className = 'fas fa-moon';
            themeText.textContent = 'Dark Mode';
        } else {
            html.setAttribute('data-theme', 'dark');
            localStorage.setItem('theme', 'dark');
            themeIcon.className = 'fas fa-sun';
            themeText.textContent = 'Light Mode';
        }

        // Re-render with new colors
        updateInputHighlight();
        if (currentViewMode === 'formatted' && currentParsedJSON) {
            const formattedJson = JSON.stringify(currentParsedJSON, null, 2);
            document.getElementById('jsonOutput').innerHTML = syntaxHighlight(formattedJson);
        }
    }

    function initializeTheme() {
        const savedTheme = localStorage.getItem('theme') || 'light';
        const themeIcon = document.getElementById('theme-icon');
        const themeText = document.getElementById('theme-text');

        if (savedTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            if (themeIcon) {
                themeIcon.className = 'fas fa-sun';
                themeText.textContent = 'Light Mode';
            }
        }
    }

    function toggleFormat() {
        isJsonMode = document.getElementById('formatToggle').checked;
        convertFormat();
    }

    function convertFormat() {
        const input = document.getElementById('jsonInput').value.trim();
        const errorAlert = document.getElementById('errorAlert');
        const jsonOutput = document.getElementById('jsonOutput');
        const fixStatus = document.getElementById('fixStatus');
        const autoFixEnabled = document.getElementById('autoFixToggle').checked;

        if (!input) {
            jsonOutput.innerHTML = '';
            document.getElementById('treeView').innerHTML = '';
            errorAlert.classList.remove('show');
            fixStatus.classList.remove('show');
            return;
        }

        try {
            if (isJsonMode) {
                let processedInput = input;

                if (input.startsWith('"') && input.endsWith('"')) {
                    try {
                        processedInput = JSON.parse(input);
                    } catch (e) {
                        processedInput = input;
                    }
                }

                try {
                    const parsedJson = JSON.parse(processedInput);
                    currentParsedJSON = parsedJson;
                    const formattedJson = JSON.stringify(parsedJson, null, 2);

                    jsonOutput.innerHTML = syntaxHighlight(formattedJson);

                    if (currentViewMode === 'tree') {
                        renderTreeView(parsedJson);
                    }

                    fixStatus.classList.remove('show');
                    errorAlert.classList.remove('show');
                } catch (parseError) {
                    if (autoFixEnabled) {
                        const result = autoFixJSON(processedInput);

                        try {
                            const parsedJson = JSON.parse(result.fixed);
                            currentParsedJSON = parsedJson;
                            const formattedJson = JSON.stringify(parsedJson, null, 2);

                            jsonOutput.innerHTML = syntaxHighlight(formattedJson);

                            if (currentViewMode === 'tree') {
                                renderTreeView(parsedJson);
                            }

                            fixStatus.classList.add('show');
                            document.getElementById('fixStatusText').textContent =
                                `‚úÖ ${result.changes.join(', ')}`;

                            showAlert('warning', `Auto-fix: ${result.changes.join(', ')}`);

                            setTimeout(() => {
                                fixStatus.classList.remove('show');
                            }, 7000);

                            errorAlert.classList.remove('show');
                        } catch (fixError) {
                            throw new Error(`Kh√¥ng th·ªÉ t·ª± ƒë·ªông s·ª≠a: ${fixError.message}`);
                        }
                    } else {
                        throw parseError;
                    }
                }
            } else {
                const parsedJson = JSON.parse(input);
                currentParsedJSON = parsedJson;
                const jsonString = JSON.stringify(JSON.stringify(parsedJson));
                jsonOutput.textContent = jsonString;

                fixStatus.classList.remove('show');
            }
            errorAlert.classList.remove('show');
        } catch (err) {
            errorAlert.classList.add('show');
            document.getElementById('errorText').textContent = err.message;
            jsonOutput.innerHTML = '';
            document.getElementById('treeView').innerHTML = '';
            fixStatus.classList.remove('show');

            setTimeout(() => {
                errorAlert.classList.remove('show');
            }, 5000);
        }
    }

    function minifyJSON() {
        const input = document.getElementById('jsonInput').value.trim();
        const jsonOutput = document.getElementById('jsonOutput');

        if (!input) {
            showAlert('error', 'Vui l√≤ng nh·∫≠p JSON!');
            return;
        }

        try {
            const parsedJson = JSON.parse(input);
            const minified = JSON.stringify(parsedJson);
            currentParsedJSON = parsedJson;

            jsonOutput.textContent = minified;

            showAlert('success', 'ƒê√£ minify JSON!');
        } catch (err) {
            showAlert('error', `L·ªói: ${err.message}`);
        }
    }

    function clearAll() {
        document.getElementById('jsonInput').value = '';
        document.getElementById('jsonInputHighlight').innerHTML = '';
        document.getElementById('jsonOutput').innerHTML = '';
        document.getElementById('treeView').innerHTML = '';
        document.getElementById('fixStatus').classList.remove('show');
        currentParsedJSON = null;
        hideAllAlerts();
    }

    async function copyToClipboard() {
        const jsonOutput = document.getElementById('jsonOutput').textContent;

        if (!jsonOutput.trim()) {
            showAlert('error', 'Kh√¥ng c√≥ g√¨ ƒë·ªÉ copy!');
            return;
        }

        try {
            await navigator.clipboard.writeText(jsonOutput);
            showAlert('success', 'ƒê√£ copy v√†o clipboard!');
        } catch (err) {
            showAlert('error', 'Kh√¥ng th·ªÉ copy!');
        }
    }

    function downloadJSON() {
        const jsonOutput = document.getElementById('jsonOutput').textContent;

        if (!jsonOutput.trim()) {
            showAlert('error', 'Kh√¥ng c√≥ g√¨ ƒë·ªÉ t·∫£i!');
            return;
        }

        try {
            const blob = new Blob([jsonOutput], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            a.href = url;
            a.download = `json-${timestamp}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showAlert('success', 'ƒê√£ t·∫£i xu·ªëng!');
        } catch (err) {
            showAlert('error', 'Kh√¥ng th·ªÉ t·∫£i xu·ªëng!');
        }
    }

    function changeViewMode(mode) {
        currentViewMode = mode;

        document.querySelectorAll('.view-mode-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.mode === mode) {
                btn.classList.add('active');
            }
        });

        const formattedView = document.getElementById('formattedView');
        const treeView = document.getElementById('treeView');

        if (mode === 'formatted') {
            formattedView.style.display = 'block';
            treeView.style.display = 'none';
        } else {
            formattedView.style.display = 'none';
            treeView.style.display = 'block';

            if (currentParsedJSON) {
                renderTreeView(currentParsedJSON);
            }
        }
    }

    function renderTreeView(obj, container = null) {
        if (!container) {
            container = document.getElementById('treeView');
            container.innerHTML = '';
        }

        const tree = createTreeNode(obj, 'root', true);
        container.appendChild(tree);
    }

    function createTreeNode(value, key, isRoot = false) {
        const line = document.createElement('div');
        line.className = 'tree-line';

        if (value === null) {
            line.innerHTML = `<span class="tree-key">${escapeHtml(key)}:</span> <span class="tree-null">null</span>`;
            return line;
        }

        const type = Array.isArray(value) ? 'array' : typeof value;

        switch (type) {
            case 'object':
                const objToggle = document.createElement('span');
                objToggle.className = 'tree-toggle';
                objToggle.textContent = '‚ñº';
                objToggle.onclick = function () {
                    this.textContent = this.textContent === '‚ñº' ? '‚ñ∂' : '‚ñº';
                    const children = this.parentElement.querySelector('.tree-node');
                    children.classList.toggle('tree-collapsed');
                };

                line.appendChild(objToggle);
                const objKey = document.createElement('span');
                objKey.className = 'tree-key';
                objKey.textContent = isRoot ? 'root' : key;
                line.appendChild(objKey);
                line.appendChild(document.createTextNode(': {'));

                const objNode = document.createElement('div');
                objNode.className = 'tree-node';

                Object.entries(value).forEach(([k, v]) => {
                    objNode.appendChild(createTreeNode(v, k));
                });

                line.appendChild(objNode);

                const closeBrace = document.createElement('div');
                closeBrace.className = 'tree-line';
                closeBrace.textContent = '}';
                line.appendChild(closeBrace);
                break;

            case 'array':
                const arrToggle = document.createElement('span');
                arrToggle.className = 'tree-toggle';
                arrToggle.textContent = '‚ñº';
                arrToggle.onclick = function () {
                    this.textContent = this.textContent === '‚ñº' ? '‚ñ∂' : '‚ñº';
                    const children = this.parentElement.querySelector('.tree-node');
                    children.classList.toggle('tree-collapsed');
                };

                line.appendChild(arrToggle);
                const arrKey = document.createElement('span');
                arrKey.className = 'tree-key';
                arrKey.textContent = key;
                line.appendChild(arrKey);
                line.appendChild(document.createTextNode(`: [${value.length}]`));

                const arrNode = document.createElement('div');
                arrNode.className = 'tree-node';

                value.forEach((item, index) => {
                    arrNode.appendChild(createTreeNode(item, `[${index}]`));
                });

                line.appendChild(arrNode);

                const closeBracket = document.createElement('div');
                closeBracket.className = 'tree-line';
                closeBracket.textContent = ']';
                line.appendChild(closeBracket);
                break;

            case 'string':
                line.innerHTML = `<span class="tree-key">${escapeHtml(key)}:</span> <span class="tree-string">"${escapeHtml(String(value))}"</span>`;
                break;

            case 'number':
                line.innerHTML = `<span class="tree-key">${escapeHtml(key)}:</span> <span class="tree-number">${value}</span>`;
                break;

            case 'boolean':
                line.innerHTML = `<span class="tree-key">${escapeHtml(key)}:</span> <span class="tree-boolean">${value}</span>`;
                break;

            default:
                line.innerHTML = `<span class="tree-key">${escapeHtml(key)}:</span> <span class="tree-value">${escapeHtml(String(value))}</span>`;
        }

        return line;
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function toggleShortcuts() {
        const shortcuts = document.getElementById('shortcutsInfo');
        shortcuts.classList.toggle('show');
    }

    function showAlert(type, message) {
        const alertId = type + 'Alert';
        const textId = type + 'Text';
        const alert = document.getElementById(alertId);
        const text = document.getElementById(textId);

        if (alert && text) {
            text.textContent = message;
            alert.classList.add('show');

            setTimeout(() => {
                alert.classList.remove('show');
            }, 3000);
        }
    }

    function hideAllAlerts() {
        document.querySelectorAll('.alert').forEach(alert => {
            alert.classList.remove('show');
        });
    }
</script>
</body>
</html>